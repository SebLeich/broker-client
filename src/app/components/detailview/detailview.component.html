<mat-card *ngIf="serviceCount > 0; else noService" (dblclick)=log(currentService)>
    <form class="form" *ngIf="editMode && isLoggedIn; else readOnly">
        <mat-form-field class="width">
            <input matInput class="headline primary-color" placeholder="Bezeichnung" name="serviceName"
                [(ngModel)]="currentService.serviceName">
        </mat-form-field>
        <mat-form-field class="width">
            <input matInput placeholder="Titel" name="serviceTitle" [(ngModel)]="currentService.serviceTitle">
        </mat-form-field>
        <mat-form-field class="width">
            <textarea matInput class="subtitle" placeholder="Beschreibung" name="serviceDescription"
                [(ngModel)]="currentService.serviceDescription"></textarea>
        </mat-form-field>
        <mat-form-field class="width">
            <input matInput placeholder="Verfügbarkeit" name="servcieAvailability"
                [(ngModel)]="currentService.servcieAvailability">
        </mat-form-field>
        <mat-form-field class="width">
            <mat-select [placeholder]=selectCategoryPlaceholder [ngModel]="currentService.cloudServiceCategoryId"
                (ngModelChange)="currentService.cloudServiceCategoryId=$event" name="cloudServiceCategoryId">
                <mat-option *ngFor="let c of serviceCategories" [value]="c.id">
                    {{ c.cloudServiceCategoryName }}
                </mat-option>
                <mat-option (click)="showCategoryAdder=true;" class="mat-option-adder">
                    <mat-icon class="icon">add</mat-icon>
                    Kategorie anlegen ...
                </mat-option>
            </mat-select>
        </mat-form-field>
        <div *ngIf="showCategoryAdder">
            <mat-form-field class="add-on">
                <input matInput #newCSCat placeholder="Neue Service Kategorie"
                    (keydown.enter)="addServiceCategory(newCSCat.value)" />
            </mat-form-field>
            <button class="add-on-button" mat-raised-button color="primary"
                (click)="addServiceCategory(newCSCat.value)">
                Anlegen
            </button>
        </div>
        <mat-form-field class="width">
            <mat-select [placeholder]=selectServiceModelPlaceholder [ngModel]="currentService.cloudServiceModelId"
                (ngModelChange)="currentService.cloudServiceModelId=$event" name="cloudServiceModelId">
                <mat-option *ngFor="let m of serviceModels" [value]="m.id">
                    {{ m.cloudServiceModelName }}
                </mat-option>
                <mat-option (click)="showServiceModelAdder=true;" class="mat-option-adder">
                    <mat-icon class="icon">add</mat-icon>
                    Service Modell anlegen ...
                </mat-option>
            </mat-select>
        </mat-form-field>
        <div *ngIf="showServiceModelAdder">
            <mat-form-field class="add-on">
                <input matInput #newCSMod placeholder="Neues Service Modell"
                    (keydown.enter)="addServiceModel(newCSMod.value)" />
            </mat-form-field>
            <button class="add-on-button" mat-raised-button color="primary" (click)="addServiceModel(newCSMod.value)">
                Anlegen
            </button>
        </div>
        <mat-form-field class="width">
            <mat-label>Zertifikate</mat-label>
            <mat-select (selectionChange)="setCertificates($event)" [value]="currentService.certificateIds()" multiple>
                <mat-option *ngFor="let c of certificates" [value]="c.id">{{c.certificateName}}</mat-option>
                <mat-option (click)="showCertAdder = true" class="mat-option-adder">
                    <mat-icon class="icon">add</mat-icon>
                    Zertifikat anlegen ...
                </mat-option>
            </mat-select>
        </mat-form-field>
        <div *ngIf="showCertAdder">
            <mat-form-field class="add-on">
                <input matInput #newCert placeholder="Neues Zertifikat anlegen"
                    (keydown.enter)="addCertificate(newCert.value)" />
            </mat-form-field>
            <button class="add-on-button" mat-raised-button color="primary" (click)="addCertificate(newCert.value)">
                Anlegen
            </button>
        </div>
        <mat-form-field *ngIf="displayStorageType" class="width">
            <mat-select [placeholder]="selectStorageTypePlaceholder" [ngModel]="currentService.storageTypeId"
                (ngModelChange)="currentService.storageTypeId=$event" name="storageTypeId">
                <mat-option *ngFor="let t of storageTypes" [value]="t.id">
                    {{ t.storageTypeDescription }}
                </mat-option>
                <mat-option (click)="showStorageTypeAdder=true;" class="mat-option-adder">
                    <mat-icon class="icon">add</mat-icon>
                    Speicherart anlegen ...
                </mat-option>
            </mat-select>
        </mat-form-field>
        <div *ngIf="showStorageTypeAdder">
            <mat-form-field class="add-on">
                <input matInput #newSType placeholder="Neue Speicherart"
                    (keydown.enter)="addStorageType(newCSCat.value)" />
            </mat-form-field>
            <button class="add-on-button" mat-raised-button color="primary" (click)="addStorageType(newSType.value)">
                Anlegen
            </button>
        </div>
        <mat-form-field class="width">
            <mat-select [placeholder]=selectProviderPlaceholder [ngModel]="currentService.providerId"
                (ngModelChange)="currentService.providerId=$event" name="providerId">
                <mat-option *ngFor="let p of serviceProviders" [value]="p.id">
                    {{ p.providerName }}
                </mat-option>
                <mat-option (click)="showProviderAdder=true;" class="mat-option-adder">
                    <mat-icon class="icon">add</mat-icon>
                    Provider anlegen ...
                </mat-option>
            </mat-select>
        </mat-form-field>
        <div *ngIf="showProviderAdder">
            <mat-form-field class="add-on">
                <input matInput #newCSProv placeholder="Neuer Service Provider"
                    (keydown.enter)="addServiceProvider(newCSProv.value)" />
            </mat-form-field>
            <button class="add-on-button" mat-raised-button color="primary"
                (click)="addServiceProvider(newCSProv.value)">
                Anlegen
            </button>
        </div>
        <mat-slide-toggle *ngIf="displayFileEncryption" class="bool-slider" (change)="fileEncryption=$event"
            [checked]=currentService.hasFileEncryption>Unterstützt der Service File-Encryption?</mat-slide-toggle>
        <mat-slide-toggle *ngIf="displayFileLocking" class="bool-slider" (change)="fileLocking=$event"
            [checked]=currentService.hasFileLocking>Unterstützt der Service File-Locking?</mat-slide-toggle>
        <mat-slide-toggle *ngIf="displayFilePermissions" class="bool-slider" (change)="filePermissions=$event"
            [checked]=currentService.hasFilePermissions>Unterstützt der Service File-Permissions?</mat-slide-toggle>
        <mat-slide-toggle *ngIf="displayFileVersioning" class="bool-slider" (change)="fileVersioning=$event"
            [checked]=currentService.hasFileVersioning>
            Unterstützt der Service File-Versioning?
        </mat-slide-toggle>
        <mat-slide-toggle *ngIf="displayReplication" class="bool-slider" (change)="fileReplication=$event"
            [checked]=currentService.hasReplication>
            Unterstützt der Service Replication?
        </mat-slide-toggle>
        <mat-slide-toggle *ngIf="displayFileCompression" class="bool-slider" (change)="fileCompression=$event"
            [checked]=currentService.hasFileCompression>
            Unterstützt der Service File Compression?
        </mat-slide-toggle>
        <mat-slide-toggle *ngIf="displayDBMS" class="bool-slider" (change)="dbms=$event"
            [checked]=currentService.hasDBMS>Beinhaltet der Service ein Datenbankmanagmentsystem (DBMS)?
        </mat-slide-toggle>
    </form>
    <mat-card-title class="super-headline">
        <span class="spacer"></span>
        <div *ngIf="isLoggedIn" class="option-row">
            <div *ngIf="state == 0">
                <div *ngIf="editMode; else disableReadOnly">
                    <button mat-button (click)=toggleReadOnly()>Bearbeitung
                        deaktivieren
                    </button>
                    <button mat-icon-button class="btn-success" (click)=saveChanges()>
                        <mat-icon>save</mat-icon>
                    </button>
                </div>
                <ng-template #disableReadOnly>
                    <button mat-button (click)=toggleReadOnly()>Bearbeitung aktivieren</button>
                </ng-template>
            </div>
            <div *ngIf="state == 1" style="position: absolute; right: 20px;">
                <mat-spinner diameter="50" color="primary"></mat-spinner>
            </div>
        </div>
    </mat-card-title>
    <ng-template #readOnly>
        <form class="form">
            <mat-form-field class="width">
                <input matInput class="headline primary-color" placeholder="Bezeichnung" name="serviceName"
                    [(ngModel)]="currentService.serviceName" disabled />
            </mat-form-field>
            <mat-form-field class="width">
                <input matInput placeholder="Titel" name="serviceTitle" [(ngModel)]="currentService.serviceTitle"
                    disabled />
            </mat-form-field>
            <mat-form-field class="width">
                <textarea matInput class="subtitle" placeholder="Beschreibung" name="serviceDescription"
                    [(ngModel)]="currentService.serviceDescription" disabled></textarea>
            </mat-form-field>
            <mat-form-field class="width">
                <input matInput placeholder="Verfügbarkeit" name="servcieAvailability"
                    [ngModel]="currentService.servcieAvailability" disabled />
            </mat-form-field>
            <mat-form-field class="width">
                <input matInput placeholder="Service Kategorie" name="cloudServiceCategoryId"
                    [ngModel]="currentService.cloudServiceCategoryId|servicecategory:serviceCategories" disabled />
            </mat-form-field>
            <mat-form-field class="width">
                <input matInput placeholder="Service Modell" name="cloudServiceModel"
                    [ngModel]="currentService.cloudServiceModelId|servicemodel:serviceModels" disabled />
            </mat-form-field>
            <mat-form-field class="width" disabled>
                <mat-label #cert>Zertifikate</mat-label>
                <mat-chip-list #certList aria-label="cert" disabled>
                    <mat-chip *ngFor="let c of currentService.serviceCertificates">
                        {{ c.certificate.certificateName }}
                    </mat-chip>
                </mat-chip-list>
            </mat-form-field>
            <mat-form-field class="width">
                <input matInput placeholder="Service Provider" name="providerId"
                    [ngModel]="currentService.providerId|serviceprovider:serviceProviders" disabled />
            </mat-form-field>
            <mat-slide-toggle *ngIf="displayFileEncryption" class="bool-slider"
                [checked]=currentService.hasFileEncryption [disabled]=true>
                Unterstützt der Service File-Encryption?
            </mat-slide-toggle>
            <mat-slide-toggle *ngIf="displayFileLocking" class="bool-slider" [checked]=currentService.hasFileLocking
                [disabled]=true>
                Unterstützt der Service File-Locking?
            </mat-slide-toggle>
            <mat-slide-toggle *ngIf="displayFilePermissions" class="bool-slider"
                [checked]=currentService.hasFilePermissions [disabled]=true>
                Unterstützt der Service File-Permissions?
            </mat-slide-toggle>
            <mat-slide-toggle *ngIf="displayFileVersioning" class="bool-slider"
                [checked]=currentService.hasFileVersioning [disabled]=true>
                Unterstützt der Service File-Versioning?
            </mat-slide-toggle>
            <mat-slide-toggle *ngIf="displayReplication" class="bool-slider" [checked]=currentService.hasReplication
                [disabled]=true>
                Unterstützt der Service Replication?
            </mat-slide-toggle>
            <mat-slide-toggle *ngIf="displayFileCompression" class="bool-slider" [checked]=currentService.hasFileCompression [disabled]=true>
                Unterstützt der Service File Compression?
            </mat-slide-toggle>
            <mat-slide-toggle *ngIf="displayDBMS" class="bool-slider" [checked]=currentService.hasDBMS [disabled]=true>
                Beinhaltet der Service ein Datenbankmanagmentsystem (DBMS)?
            </mat-slide-toggle>
        </form>
    </ng-template>
</mat-card>
<ng-template #noService>
    <mat-card>
        <mat-card-title>
            Keine Empfehlungen
        </mat-card-title>
        <mat-card-subtitle>
            Wir haben leider keine Empfehlungen für Sie gefunden.
        </mat-card-subtitle>
    </mat-card>
</ng-template>
<mat-autocomplete #categories="matAutocomplete">
    <mat-option *ngFor="let c of serviceCategories" [value]="c.id">
        {{ c.cloudServiceCategoryName }}
    </mat-option>
</mat-autocomplete>